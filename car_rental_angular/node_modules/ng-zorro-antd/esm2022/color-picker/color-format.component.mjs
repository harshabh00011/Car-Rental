/**
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE
 */
import { ChangeDetectionStrategy, Component, Input, Output, EventEmitter } from '@angular/core';
import { Subject } from 'rxjs';
import { debounceTime, filter, takeUntil } from 'rxjs/operators';
import { generateColor } from 'ng-antd-color-picker';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "@angular/common";
import * as i3 from "ng-zorro-antd/select";
import * as i4 from "ng-zorro-antd/input-number";
import * as i5 from "ng-zorro-antd/input";
class NzColorFormatComponent {
    validatorFn() {
        return (control) => {
            const REGEXP = /^[0-9a-fA-F]{6}$/;
            if (!control.value) {
                return { error: true };
            }
            else if (!REGEXP.test(control.value)) {
                return { error: true };
            }
            return null;
        };
    }
    constructor(formBuilder) {
        this.formBuilder = formBuilder;
        this.format = null;
        this.colorValue = '';
        this.clearColor = false;
        this.formatChange = new EventEmitter();
        this.nzOnFormatChange = new EventEmitter();
        this.destroy$ = new Subject();
        this.formatterPercent = (value) => `${value} %`;
        this.parserPercent = (value) => value.replace(' %', '');
        this.validateForm = this.formBuilder.nonNullable.group({
            isFormat: this.formBuilder.control('hex'),
            hex: this.formBuilder.control('1677FF', this.validatorFn()),
            hsbH: 215,
            hsbS: 91,
            hsbB: 100,
            rgbR: 22,
            rgbG: 119,
            rgbB: 255,
            roundA: 100
        });
    }
    ngOnInit() {
        this.validateForm.valueChanges
            .pipe(filter(() => this.validateForm.valid), debounceTime(200), takeUntil(this.destroy$))
            .subscribe(value => {
            let color = '';
            switch (value.isFormat) {
                case 'hsb':
                    color = generateColor({
                        h: Number(value.hsbH),
                        s: Number(value.hsbS) / 100,
                        b: Number(value.hsbB) / 100,
                        a: Number(value.roundA) / 100
                    }).toHsbString();
                    break;
                case 'rgb':
                    color = generateColor({
                        r: Number(value.rgbR),
                        g: Number(value.rgbG),
                        b: Number(value.rgbB),
                        a: Number(value.roundA) / 100
                    }).toRgbString();
                    break;
                default:
                    const hex = generateColor(value.hex);
                    const hexColor = generateColor({
                        r: hex.r,
                        g: hex.g,
                        b: hex.b,
                        a: Number(value.roundA) / 100
                    });
                    color = hexColor.getAlpha() < 1 ? hexColor.toHex8String() : hexColor.toHexString();
                    break;
            }
            this.formatChange.emit({ color, format: value.isFormat || this.format || 'hex' });
        });
        this.validateForm
            .get('isFormat')
            ?.valueChanges.pipe(takeUntil(this.destroy$))
            .subscribe(value => {
            this.nzOnFormatChange.emit(value);
        });
    }
    ngOnChanges(changes) {
        const { colorValue, format, clearColor } = changes;
        if (colorValue) {
            const colorValue = {
                hex: generateColor(this.colorValue).toHex(),
                hsbH: Math.round(generateColor(this.colorValue).toHsb().h),
                hsbS: Math.round(generateColor(this.colorValue).toHsb().s * 100),
                hsbB: Math.round(generateColor(this.colorValue).toHsb().b * 100),
                rgbR: Math.round(generateColor(this.colorValue).r),
                rgbG: Math.round(generateColor(this.colorValue).g),
                rgbB: Math.round(generateColor(this.colorValue).b),
                roundA: Math.round(generateColor(this.colorValue).roundA * 100)
            };
            this.validateForm.patchValue(colorValue);
        }
        if (format && this.format) {
            this.validateForm.get('isFormat')?.patchValue(this.format);
        }
        if (clearColor && this.clearColor) {
            this.validateForm.get('roundA')?.patchValue(0);
        }
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.10", ngImport: i0, type: NzColorFormatComponent, deps: [{ token: i1.FormBuilder }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.10", type: NzColorFormatComponent, selector: "nz-color-format", inputs: { format: "format", colorValue: "colorValue", clearColor: "clearColor" }, outputs: { formatChange: "formatChange", nzOnFormatChange: "nzOnFormatChange" }, exportAs: ["NzColorFormat"], usesOnChanges: true, ngImport: i0, template: `
    <div [formGroup]="validateForm" class="ant-color-picker-input-container">
      <div class="ant-color-picker-format-select">
        <nz-select formControlName="isFormat" nzBorderless nzSize="small">
          <nz-option nzValue="hex" nzLabel="HEX"></nz-option>
          <nz-option nzValue="hsb" nzLabel="HSB"></nz-option>
          <nz-option nzValue="rgb" nzLabel="RGB"></nz-option>
        </nz-select>
      </div>
      <div class="ant-color-picker-input" [ngSwitch]="validateForm.get('isFormat')?.value">
        <div class="ant-color-picker-hex-input" *ngSwitchCase="'hex'">
          <nz-input-group nzPrefix="#" nzSize="small">
            <input nz-input nzSize="small" formControlName="hex" />
          </nz-input-group>
        </div>

        <div class="ant-color-picker-hsb-input" *ngSwitchCase="'hsb'">
          <div class="ant-color-picker-steppers ant-color-picker-hsb-input">
            <nz-input-number
              formControlName="hsbH"
              [nzMin]="0"
              [nzMax]="360"
              [nzStep]="1"
              [nzPrecision]="0"
              nzSize="small"
            ></nz-input-number>
          </div>
          <div class="ant-color-picker-steppers ant-color-picker-hsb-input">
            <nz-input-number
              formControlName="hsbS"
              [nzMin]="0"
              [nzMax]="100"
              [nzStep]="1"
              [nzFormatter]="formatterPercent"
              [nzParser]="parserPercent"
              nzSize="small"
            ></nz-input-number>
          </div>
          <div class="ant-color-picker-steppers ant-color-picker-hsb-input">
            <nz-input-number
              formControlName="hsbB"
              [nzMin]="0"
              [nzMax]="100"
              [nzStep]="1"
              [nzFormatter]="formatterPercent"
              [nzParser]="parserPercent"
              nzSize="small"
            ></nz-input-number>
          </div>
        </div>

        <div class="ant-color-picker-rgb-input" *ngSwitchDefault>
          <div class="ant-color-picker-steppers ant-color-picker-rgb-input">
            <nz-input-number formControlName="rgbR" [nzMin]="0" [nzMax]="255" [nzStep]="1" nzSize="small">
            </nz-input-number>
          </div>
          <div class="ant-color-picker-steppers ant-color-picker-rgb-input">
            <nz-input-number
              formControlName="rgbG"
              [nzMin]="0"
              [nzMax]="255"
              [nzStep]="1"
              nzSize="small"
            ></nz-input-number>
          </div>
          <div class="ant-color-picker-steppers ant-color-picker-rgb-input">
            <nz-input-number
              formControlName="rgbB"
              [nzMin]="0"
              [nzMax]="255"
              [nzStep]="1"
              nzSize="small"
            ></nz-input-number>
          </div>
        </div>
      </div>

      <div class="ant-color-picker-steppers ant-color-picker-alpha-input">
        <nz-input-number
          formControlName="roundA"
          [nzMin]="0"
          [nzMax]="100"
          [nzStep]="1"
          [nzFormatter]="formatterPercent"
          [nzParser]="parserPercent"
          nzSize="small"
        ></nz-input-number>
      </div>
    </div>
  `, isInline: true, dependencies: [{ kind: "directive", type: i2.NgSwitch, selector: "[ngSwitch]", inputs: ["ngSwitch"] }, { kind: "directive", type: i2.NgSwitchCase, selector: "[ngSwitchCase]", inputs: ["ngSwitchCase"] }, { kind: "directive", type: i2.NgSwitchDefault, selector: "[ngSwitchDefault]" }, { kind: "component", type: i3.NzOptionComponent, selector: "nz-option", inputs: ["nzTitle", "nzLabel", "nzValue", "nzKey", "nzDisabled", "nzHide", "nzCustomContent"], exportAs: ["nzOption"] }, { kind: "component", type: i3.NzSelectComponent, selector: "nz-select", inputs: ["nzId", "nzSize", "nzStatus", "nzOptionHeightPx", "nzOptionOverflowSize", "nzDropdownClassName", "nzDropdownMatchSelectWidth", "nzDropdownStyle", "nzNotFoundContent", "nzPlaceHolder", "nzPlacement", "nzMaxTagCount", "nzDropdownRender", "nzCustomTemplate", "nzSuffixIcon", "nzClearIcon", "nzRemoveIcon", "nzMenuItemSelectedIcon", "nzTokenSeparators", "nzMaxTagPlaceholder", "nzMaxMultipleCount", "nzMode", "nzFilterOption", "compareWith", "nzAllowClear", "nzBorderless", "nzShowSearch", "nzLoading", "nzAutoFocus", "nzAutoClearSearchValue", "nzServerSearch", "nzDisabled", "nzOpen", "nzSelectOnTab", "nzBackdrop", "nzOptions", "nzShowArrow"], outputs: ["nzOnSearch", "nzScrollToBottom", "nzOpenChange", "nzBlur", "nzFocus"], exportAs: ["nzSelect"] }, { kind: "directive", type: i1.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i1.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i1.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "component", type: i4.NzInputNumberComponent, selector: "nz-input-number", inputs: ["nzSize", "nzMin", "nzMax", "nzParser", "nzPrecision", "nzPrecisionMode", "nzPlaceHolder", "nzStatus", "nzStep", "nzInputMode", "nzId", "nzDisabled", "nzReadOnly", "nzAutoFocus", "nzBorderless", "nzFormatter"], outputs: ["nzBlur", "nzFocus"], exportAs: ["nzInputNumber"] }, { kind: "directive", type: i5.NzInputDirective, selector: "input[nz-input],textarea[nz-input]", inputs: ["nzBorderless", "nzSize", "nzStepperless", "nzStatus", "disabled"], exportAs: ["nzInput"] }, { kind: "component", type: i5.NzInputGroupComponent, selector: "nz-input-group", inputs: ["nzAddOnBeforeIcon", "nzAddOnAfterIcon", "nzPrefixIcon", "nzSuffixIcon", "nzAddOnBefore", "nzAddOnAfter", "nzPrefix", "nzStatus", "nzSuffix", "nzSize", "nzSearch", "nzCompact"], exportAs: ["nzInputGroup"] }, { kind: "directive", type: i5.NzInputGroupWhitSuffixOrPrefixDirective, selector: "nz-input-group[nzSuffix], nz-input-group[nzPrefix]" }, { kind: "directive", type: i1.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "directive", type: i1.FormControlName, selector: "[formControlName]", inputs: ["formControlName", "disabled", "ngModel"], outputs: ["ngModelChange"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
export { NzColorFormatComponent };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.10", ngImport: i0, type: NzColorFormatComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'nz-color-format',
                    exportAs: 'NzColorFormat',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    template: `
    <div [formGroup]="validateForm" class="ant-color-picker-input-container">
      <div class="ant-color-picker-format-select">
        <nz-select formControlName="isFormat" nzBorderless nzSize="small">
          <nz-option nzValue="hex" nzLabel="HEX"></nz-option>
          <nz-option nzValue="hsb" nzLabel="HSB"></nz-option>
          <nz-option nzValue="rgb" nzLabel="RGB"></nz-option>
        </nz-select>
      </div>
      <div class="ant-color-picker-input" [ngSwitch]="validateForm.get('isFormat')?.value">
        <div class="ant-color-picker-hex-input" *ngSwitchCase="'hex'">
          <nz-input-group nzPrefix="#" nzSize="small">
            <input nz-input nzSize="small" formControlName="hex" />
          </nz-input-group>
        </div>

        <div class="ant-color-picker-hsb-input" *ngSwitchCase="'hsb'">
          <div class="ant-color-picker-steppers ant-color-picker-hsb-input">
            <nz-input-number
              formControlName="hsbH"
              [nzMin]="0"
              [nzMax]="360"
              [nzStep]="1"
              [nzPrecision]="0"
              nzSize="small"
            ></nz-input-number>
          </div>
          <div class="ant-color-picker-steppers ant-color-picker-hsb-input">
            <nz-input-number
              formControlName="hsbS"
              [nzMin]="0"
              [nzMax]="100"
              [nzStep]="1"
              [nzFormatter]="formatterPercent"
              [nzParser]="parserPercent"
              nzSize="small"
            ></nz-input-number>
          </div>
          <div class="ant-color-picker-steppers ant-color-picker-hsb-input">
            <nz-input-number
              formControlName="hsbB"
              [nzMin]="0"
              [nzMax]="100"
              [nzStep]="1"
              [nzFormatter]="formatterPercent"
              [nzParser]="parserPercent"
              nzSize="small"
            ></nz-input-number>
          </div>
        </div>

        <div class="ant-color-picker-rgb-input" *ngSwitchDefault>
          <div class="ant-color-picker-steppers ant-color-picker-rgb-input">
            <nz-input-number formControlName="rgbR" [nzMin]="0" [nzMax]="255" [nzStep]="1" nzSize="small">
            </nz-input-number>
          </div>
          <div class="ant-color-picker-steppers ant-color-picker-rgb-input">
            <nz-input-number
              formControlName="rgbG"
              [nzMin]="0"
              [nzMax]="255"
              [nzStep]="1"
              nzSize="small"
            ></nz-input-number>
          </div>
          <div class="ant-color-picker-steppers ant-color-picker-rgb-input">
            <nz-input-number
              formControlName="rgbB"
              [nzMin]="0"
              [nzMax]="255"
              [nzStep]="1"
              nzSize="small"
            ></nz-input-number>
          </div>
        </div>
      </div>

      <div class="ant-color-picker-steppers ant-color-picker-alpha-input">
        <nz-input-number
          formControlName="roundA"
          [nzMin]="0"
          [nzMax]="100"
          [nzStep]="1"
          [nzFormatter]="formatterPercent"
          [nzParser]="parserPercent"
          nzSize="small"
        ></nz-input-number>
      </div>
    </div>
  `
                }]
        }], ctorParameters: function () { return [{ type: i1.FormBuilder }]; }, propDecorators: { format: [{
                type: Input
            }], colorValue: [{
                type: Input
            }], clearColor: [{
                type: Input
            }], formatChange: [{
                type: Output
            }], nzOnFormatChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3ItZm9ybWF0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2NvbXBvbmVudHMvY29sb3ItcGlja2VyL2NvbG9yLWZvcm1hdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztHQUdHO0FBRUgsT0FBTyxFQUNMLHVCQUF1QixFQUV2QixTQUFTLEVBQ1QsS0FBSyxFQUlMLE1BQU0sRUFDTixZQUFZLEVBQ2IsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVqRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7Ozs7Ozs7QUFJckQsTUErRmEsc0JBQXNCO0lBU2pDLFdBQVc7UUFDVCxPQUFPLENBQUMsT0FBd0IsRUFBMkIsRUFBRTtZQUMzRCxNQUFNLE1BQU0sR0FBRyxrQkFBa0IsQ0FBQztZQUNsQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRTtnQkFDbEIsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQzthQUN4QjtpQkFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQ3RDLE9BQU8sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUM7YUFDeEI7WUFDRCxPQUFPLElBQUksQ0FBQztRQUNkLENBQUMsQ0FBQztJQUNKLENBQUM7SUFpQkQsWUFBb0IsV0FBd0I7UUFBeEIsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFuQ25DLFdBQU0sR0FBbUMsSUFBSSxDQUFDO1FBQzlDLGVBQVUsR0FBVyxFQUFFLENBQUM7UUFDeEIsZUFBVSxHQUFZLEtBQUssQ0FBQztRQUNsQixpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFzRCxD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Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F5RlQ7O1NBRVUsc0JBQXNCOzRGQUF0QixzQkFBc0I7a0JBL0ZsQyxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxpQkFBaUI7b0JBQzNCLFFBQVEsRUFBRSxlQUFlO29CQUN6QixlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtvQkFDL0MsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQXlGVDtpQkFDRjtrR0FFVSxNQUFNO3NCQUFkLEtBQUs7Z0JBQ0csVUFBVTtzQkFBbEIsS0FBSztnQkFDRyxVQUFVO3NCQUFsQixLQUFLO2dCQUNhLFlBQVk7c0JBQTlCLE1BQU07Z0JBQ1ksZ0JBQWdCO3NCQUFsQyxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZVxuICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL2dpdGh1Yi5jb20vTkctWk9SUk8vbmctem9ycm8tYW50ZC9ibG9iL21hc3Rlci9MSUNFTlNFXG4gKi9cblxuaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIFNpbXBsZUNoYW5nZXMsXG4gIENvbXBvbmVudCxcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sLCBGb3JtQnVpbGRlciwgRm9ybUNvbnRyb2wsIEZvcm1Hcm91cCwgVmFsaWRhdGlvbkVycm9ycywgVmFsaWRhdG9yRm4gfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUsIGZpbHRlciwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBnZW5lcmF0ZUNvbG9yIH0gZnJvbSAnbmctYW50ZC1jb2xvci1waWNrZXInO1xuXG5pbXBvcnQgeyBOekNvbG9yUGlja2VyRm9ybWF0VHlwZSB9IGZyb20gJy4vdHlwaW5ncyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ256LWNvbG9yLWZvcm1hdCcsXG4gIGV4cG9ydEFzOiAnTnpDb2xvckZvcm1hdCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxkaXYgW2Zvcm1Hcm91cF09XCJ2YWxpZGF0ZUZvcm1cIiBjbGFzcz1cImFudC1jb2xvci1waWNrZXItaW5wdXQtY29udGFpbmVyXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwiYW50LWNvbG9yLXBpY2tlci1mb3JtYXQtc2VsZWN0XCI+XG4gICAgICAgIDxuei1zZWxlY3QgZm9ybUNvbnRyb2xOYW1lPVwiaXNGb3JtYXRcIiBuekJvcmRlcmxlc3MgbnpTaXplPVwic21hbGxcIj5cbiAgICAgICAgICA8bnotb3B0aW9uIG56VmFsdWU9XCJoZXhcIiBuekxhYmVsPVwiSEVYXCI+PC9uei1vcHRpb24+XG4gICAgICAgICAgPG56LW9wdGlvbiBuelZhbHVlPVwiaHNiXCIgbnpMYWJlbD1cIkhTQlwiPjwvbnotb3B0aW9uPlxuICAgICAgICAgIDxuei1vcHRpb24gbnpWYWx1ZT1cInJnYlwiIG56TGFiZWw9XCJSR0JcIj48L256LW9wdGlvbj5cbiAgICAgICAgPC9uei1zZWxlY3Q+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3M9XCJhbnQtY29sb3ItcGlja2VyLWlucHV0XCIgW25nU3dpdGNoXT1cInZhbGlkYXRlRm9ybS5nZXQoJ2lzRm9ybWF0Jyk/LnZhbHVlXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJhbnQtY29sb3ItcGlja2VyLWhleC1pbnB1dFwiICpuZ1N3aXRjaENhc2U9XCInaGV4J1wiPlxuICAgICAgICAgIDxuei1pbnB1dC1ncm91cCBuelByZWZpeD1cIiNcIiBuelNpemU9XCJzbWFsbFwiPlxuICAgICAgICAgICAgPGlucHV0IG56LWlucHV0IG56U2l6ZT1cInNtYWxsXCIgZm9ybUNvbnRyb2xOYW1lPVwiaGV4XCIgLz5cbiAgICAgICAgICA8L256LWlucHV0LWdyb3VwPlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8ZGl2IGNsYXNzPVwiYW50LWNvbG9yLXBpY2tlci1oc2ItaW5wdXRcIiAqbmdTd2l0Y2hDYXNlPVwiJ2hzYidcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiYW50LWNvbG9yLXBpY2tlci1zdGVwcGVycyBhbnQtY29sb3ItcGlja2VyLWhzYi1pbnB1dFwiPlxuICAgICAgICAgICAgPG56LWlucHV0LW51bWJlclxuICAgICAgICAgICAgICBmb3JtQ29udHJvbE5hbWU9XCJoc2JIXCJcbiAgICAgICAgICAgICAgW256TWluXT1cIjBcIlxuICAgICAgICAgICAgICBbbnpNYXhdPVwiMzYwXCJcbiAgICAgICAgICAgICAgW256U3RlcF09XCIxXCJcbiAgICAgICAgICAgICAgW256UHJlY2lzaW9uXT1cIjBcIlxuICAgICAgICAgICAgICBuelNpemU9XCJzbWFsbFwiXG4gICAgICAgICAgICA+PC9uei1pbnB1dC1udW1iZXI+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImFudC1jb2xvci1waWNrZXItc3RlcHBlcnMgYW50LWNvbG9yLXBpY2tlci1oc2ItaW5wdXRcIj5cbiAgICAgICAgICAgIDxuei1pbnB1dC1udW1iZXJcbiAgICAgICAgICAgICAgZm9ybUNvbnRyb2xOYW1lPVwiaHNiU1wiXG4gICAgICAgICAgICAgIFtuek1pbl09XCIwXCJcbiAgICAgICAgICAgICAgW256TWF4XT1cIjEwMFwiXG4gICAgICAgICAgICAgIFtuelN0ZXBdPVwiMVwiXG4gICAgICAgICAgICAgIFtuekZvcm1hdHRlcl09XCJmb3JtYXR0ZXJQZXJjZW50XCJcbiAgICAgICAgICAgICAgW256UGFyc2VyXT1cInBhcnNlclBlcmNlbnRcIlxuICAgICAgICAgICAgICBuelNpemU9XCJzbWFsbFwiXG4gICAgICAgICAgICA+PC9uei1pbnB1dC1udW1iZXI+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImFudC1jb2xvci1waWNrZXItc3RlcHBlcnMgYW50LWNvbG9yLXBpY2tlci1oc2ItaW5wdXRcIj5cbiAgICAgICAgICAgIDxuei1pbnB1dC1udW1iZXJcbiAgICAgICAgICAgICAgZm9ybUNvbnRyb2xOYW1lPVwiaHNiQlwiXG4gICAgICAgICAgICAgIFtuek1pbl09XCIwXCJcbiAgICAgICAgICAgICAgW256TWF4XT1cIjEwMFwiXG4gICAgICAgICAgICAgIFtuelN0ZXBdPVwiMVwiXG4gICAgICAgICAgICAgIFtuekZvcm1hdHRlcl09XCJmb3JtYXR0ZXJQZXJjZW50XCJcbiAgICAgICAgICAgICAgW256UGFyc2VyXT1cInBhcnNlclBlcmNlbnRcIlxuICAgICAgICAgICAgICBuelNpemU9XCJzbWFsbFwiXG4gICAgICAgICAgICA+PC9uei1pbnB1dC1udW1iZXI+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxkaXYgY2xhc3M9XCJhbnQtY29sb3ItcGlja2VyLXJnYi1pbnB1dFwiICpuZ1N3aXRjaERlZmF1bHQ+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImFudC1jb2xvci1waWNrZXItc3RlcHBlcnMgYW50LWNvbG9yLXBpY2tlci1yZ2ItaW5wdXRcIj5cbiAgICAgICAgICAgIDxuei1pbnB1dC1udW1iZXIgZm9ybUNvbnRyb2xOYW1lPVwicmdiUlwiIFtuek1pbl09XCIwXCIgW256TWF4XT1cIjI1NVwiIFtuelN0ZXBdPVwiMVwiIG56U2l6ZT1cInNtYWxsXCI+XG4gICAgICAgICAgICA8L256LWlucHV0LW51bWJlcj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiYW50LWNvbG9yLXBpY2tlci1zdGVwcGVycyBhbnQtY29sb3ItcGlja2VyLXJnYi1pbnB1dFwiPlxuICAgICAgICAgICAgPG56LWlucHV0LW51bWJlclxuICAgICAgICAgICAgICBmb3JtQ29udHJvbE5hbWU9XCJyZ2JHXCJcbiAgICAgICAgICAgICAgW256TWluXT1cIjBcIlxuICAgICAgICAgICAgICBbbnpNYXhdPVwiMjU1XCJcbiAgICAgICAgICAgICAgW256U3RlcF09XCIxXCJcbiAgICAgICAgICAgICAgbnpTaXplPVwic21hbGxcIlxuICAgICAgICAgICAgPjwvbnotaW5wdXQtbnVtYmVyPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJhbnQtY29sb3ItcGlja2VyLXN0ZXBwZXJzIGFudC1jb2xvci1waWNrZXItcmdiLWlucHV0XCI+XG4gICAgICAgICAgICA8bnotaW5wdXQtbnVtYmVyXG4gICAgICAgICAgICAgIGZvcm1Db250cm9sTmFtZT1cInJnYkJcIlxuICAgICAgICAgICAgICBbbnpNaW5dPVwiMFwiXG4gICAgICAgICAgICAgIFtuek1heF09XCIyNTVcIlxuICAgICAgICAgICAgICBbbnpTdGVwXT1cIjFcIlxuICAgICAgICAgICAgICBuelNpemU9XCJzbWFsbFwiXG4gICAgICAgICAgICA+PC9uei1pbnB1dC1udW1iZXI+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG5cbiAgICAgIDxkaXYgY2xhc3M9XCJhbnQtY29sb3ItcGlja2VyLXN0ZXBwZXJzIGFudC1jb2xvci1waWNrZXItYWxwaGEtaW5wdXRcIj5cbiAgICAgICAgPG56LWlucHV0LW51bWJlclxuICAgICAgICAgIGZvcm1Db250cm9sTmFtZT1cInJvdW5kQVwiXG4gICAgICAgICAgW256TWluXT1cIjBcIlxuICAgICAgICAgIFtuek1heF09XCIxMDBcIlxuICAgICAgICAgIFtuelN0ZXBdPVwiMVwiXG4gICAgICAgICAgW256Rm9ybWF0dGVyXT1cImZvcm1hdHRlclBlcmNlbnRcIlxuICAgICAgICAgIFtuelBhcnNlcl09XCJwYXJzZXJQZXJjZW50XCJcbiAgICAgICAgICBuelNpemU9XCJzbWFsbFwiXG4gICAgICAgID48L256LWlucHV0LW51bWJlcj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICBgXG59KVxuZXhwb3J0IGNsYXNzIE56Q29sb3JGb3JtYXRDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMsIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgQElucHV0KCkgZm9ybWF0OiBOekNvbG9yUGlja2VyRm9ybWF0VHlwZSB8IG51bGwgPSBudWxsO1xuICBASW5wdXQoKSBjb2xvclZhbHVlOiBzdHJpbmcgPSAnJztcbiAgQElucHV0KCkgY2xlYXJDb2xvcjogYm9vbGVhbiA9IGZhbHNlO1xuICBAT3V0cHV0KCkgcmVhZG9ubHkgZm9ybWF0Q2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjx7IGNvbG9yOiBzdHJpbmc7IGZvcm1hdDogTnpDb2xvclBpY2tlckZvcm1hdFR5cGUgfT4oKTtcbiAgQE91dHB1dCgpIHJlYWRvbmx5IG56T25Gb3JtYXRDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPE56Q29sb3JQaWNrZXJGb3JtYXRUeXBlPigpO1xuXG4gIHByaXZhdGUgZGVzdHJveSQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXG4gIHZhbGlkYXRvckZuKCk6IFZhbGlkYXRvckZuIHtcbiAgICByZXR1cm4gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgfCBudWxsID0+IHtcbiAgICAgIGNvbnN0IFJFR0VYUCA9IC9eWzAtOWEtZkEtRl17Nn0kLztcbiAgICAgIGlmICghY29udHJvbC52YWx1ZSkge1xuICAgICAgICByZXR1cm4geyBlcnJvcjogdHJ1ZSB9O1xuICAgICAgfSBlbHNlIGlmICghUkVHRVhQLnRlc3QoY29udHJvbC52YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIHsgZXJyb3I6IHRydWUgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG4gIH1cblxuICB2YWxpZGF0ZUZvcm06IEZvcm1Hcm91cDx7XG4gICAgaXNGb3JtYXQ6IEZvcm1Db250cm9sPE56Q29sb3JQaWNrZXJGb3JtYXRUeXBlIHwgbnVsbD47XG4gICAgaGV4OiBGb3JtQ29udHJvbDxzdHJpbmcgfCBudWxsPjtcbiAgICBoc2JIOiBGb3JtQ29udHJvbDxudW1iZXI+O1xuICAgIGhzYlM6IEZvcm1Db250cm9sPG51bWJlcj47XG4gICAgaHNiQjogRm9ybUNvbnRyb2w8bnVtYmVyPjtcbiAgICByZ2JSOiBGb3JtQ29udHJvbDxudW1iZXI+O1xuICAgIHJnYkc6IEZvcm1Db250cm9sPG51bWJlcj47XG4gICAgcmdiQjogRm9ybUNvbnRyb2w8bnVtYmVyPjtcbiAgICByb3VuZEE6IEZvcm1Db250cm9sPG51bWJlcj47XG4gIH0+O1xuXG4gIGZvcm1hdHRlclBlcmNlbnQgPSAodmFsdWU6IG51bWJlcik6IHN0cmluZyA9PiBgJHt2YWx1ZX0gJWA7XG4gIHBhcnNlclBlcmNlbnQgPSAodmFsdWU6IHN0cmluZyk6IHN0cmluZyA9PiB2YWx1ZS5yZXBsYWNlKCcgJScsICcnKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGZvcm1CdWlsZGVyOiBGb3JtQnVpbGRlcikge1xuICAgIHRoaXMudmFsaWRhdGVGb3JtID0gdGhpcy5mb3JtQnVpbGRlci5ub25OdWxsYWJsZS5ncm91cCh7XG4gICAgICBpc0Zvcm1hdDogdGhpcy5mb3JtQnVpbGRlci5jb250cm9sPE56Q29sb3JQaWNrZXJGb3JtYXRUeXBlPignaGV4JyksXG4gICAgICBoZXg6IHRoaXMuZm9ybUJ1aWxkZXIuY29udHJvbDxzdHJpbmc+KCcxNjc3RkYnLCB0aGlzLnZhbGlkYXRvckZuKCkpLFxuICAgICAgaHNiSDogMjE1LFxuICAgICAgaHNiUzogOTEsXG4gICAgICBoc2JCOiAxMDAsXG4gICAgICByZ2JSOiAyMixcbiAgICAgIHJnYkc6IDExOSxcbiAgICAgIHJnYkI6IDI1NSxcbiAgICAgIHJvdW5kQTogMTAwXG4gICAgfSk7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLnZhbGlkYXRlRm9ybS52YWx1ZUNoYW5nZXNcbiAgICAgIC5waXBlKFxuICAgICAgICBmaWx0ZXIoKCkgPT4gdGhpcy52YWxpZGF0ZUZvcm0udmFsaWQpLFxuICAgICAgICBkZWJvdW5jZVRpbWUoMjAwKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuZGVzdHJveSQpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKHZhbHVlID0+IHtcbiAgICAgICAgbGV0IGNvbG9yID0gJyc7XG4gICAgICAgIHN3aXRjaCAodmFsdWUuaXNGb3JtYXQpIHtcbiAgICAgICAgICBjYXNlICdoc2InOlxuICAgICAgICAgICAgY29sb3IgPSBnZW5lcmF0ZUNvbG9yKHtcbiAgICAgICAgICAgICAgaDogTnVtYmVyKHZhbHVlLmhzYkgpLFxuICAgICAgICAgICAgICBzOiBOdW1iZXIodmFsdWUuaHNiUykgLyAxMDAsXG4gICAgICAgICAgICAgIGI6IE51bWJlcih2YWx1ZS5oc2JCKSAvIDEwMCxcbiAgICAgICAgICAgICAgYTogTnVtYmVyKHZhbHVlLnJvdW5kQSkgLyAxMDBcbiAgICAgICAgICAgIH0pLnRvSHNiU3RyaW5nKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdyZ2InOlxuICAgICAgICAgICAgY29sb3IgPSBnZW5lcmF0ZUNvbG9yKHtcbiAgICAgICAgICAgICAgcjogTnVtYmVyKHZhbHVlLnJnYlIpLFxuICAgICAgICAgICAgICBnOiBOdW1iZXIodmFsdWUucmdiRyksXG4gICAgICAgICAgICAgIGI6IE51bWJlcih2YWx1ZS5yZ2JCKSxcbiAgICAgICAgICAgICAgYTogTnVtYmVyKHZhbHVlLnJvdW5kQSkgLyAxMDBcbiAgICAgICAgICAgIH0pLnRvUmdiU3RyaW5nKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgY29uc3QgaGV4ID0gZ2VuZXJhdGVDb2xvcih2YWx1ZS5oZXggYXMgTnpDb2xvclBpY2tlckZvcm1hdFR5cGUpO1xuICAgICAgICAgICAgY29uc3QgaGV4Q29sb3IgPSBnZW5lcmF0ZUNvbG9yKHtcbiAgICAgICAgICAgICAgcjogaGV4LnIsXG4gICAgICAgICAgICAgIGc6IGhleC5nLFxuICAgICAgICAgICAgICBiOiBoZXguYixcbiAgICAgICAgICAgICAgYTogTnVtYmVyKHZhbHVlLnJvdW5kQSkgLyAxMDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29sb3IgPSBoZXhDb2xvci5nZXRBbHBoYSgpIDwgMSA/IGhleENvbG9yLnRvSGV4OFN0cmluZygpIDogaGV4Q29sb3IudG9IZXhTdHJpbmcoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZm9ybWF0Q2hhbmdlLmVtaXQoeyBjb2xvciwgZm9ybWF0OiB2YWx1ZS5pc0Zvcm1hdCB8fCB0aGlzLmZvcm1hdCB8fCAnaGV4JyB9KTtcbiAgICAgIH0pO1xuXG4gICAgdGhpcy52YWxpZGF0ZUZvcm1cbiAgICAgIC5nZXQoJ2lzRm9ybWF0JylcbiAgICAgID8udmFsdWVDaGFuZ2VzLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKVxuICAgICAgLnN1YnNjcmliZSh2YWx1ZSA9PiB7XG4gICAgICAgIHRoaXMubnpPbkZvcm1hdENoYW5nZS5lbWl0KHZhbHVlIGFzIE56Q29sb3JQaWNrZXJGb3JtYXRUeXBlKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGNvbnN0IHsgY29sb3JWYWx1ZSwgZm9ybWF0LCBjbGVhckNvbG9yIH0gPSBjaGFuZ2VzO1xuICAgIGlmIChjb2xvclZhbHVlKSB7XG4gICAgICBjb25zdCBjb2xvclZhbHVlID0ge1xuICAgICAgICBoZXg6IGdlbmVyYXRlQ29sb3IodGhpcy5jb2xvclZhbHVlKS50b0hleCgpLFxuICAgICAgICBoc2JIOiBNYXRoLnJvdW5kKGdlbmVyYXRlQ29sb3IodGhpcy5jb2xvclZhbHVlKS50b0hzYigpLmgpLFxuICAgICAgICBoc2JTOiBNYXRoLnJvdW5kKGdlbmVyYXRlQ29sb3IodGhpcy5jb2xvclZhbHVlKS50b0hzYigpLnMgKiAxMDApLFxuICAgICAgICBoc2JCOiBNYXRoLnJvdW5kKGdlbmVyYXRlQ29sb3IodGhpcy5jb2xvclZhbHVlKS50b0hzYigpLmIgKiAxMDApLFxuICAgICAgICByZ2JSOiBNYXRoLnJvdW5kKGdlbmVyYXRlQ29sb3IodGhpcy5jb2xvclZhbHVlKS5yKSxcbiAgICAgICAgcmdiRzogTWF0aC5yb3VuZChnZW5lcmF0ZUNvbG9yKHRoaXMuY29sb3JWYWx1ZSkuZyksXG4gICAgICAgIHJnYkI6IE1hdGgucm91bmQoZ2VuZXJhdGVDb2xvcih0aGlzLmNvbG9yVmFsdWUpLmIpLFxuICAgICAgICByb3VuZEE6IE1hdGgucm91bmQoZ2VuZXJhdGVDb2xvcih0aGlzLmNvbG9yVmFsdWUpLnJvdW5kQSAqIDEwMClcbiAgICAgIH07XG4gICAgICB0aGlzLnZhbGlkYXRlRm9ybS5wYXRjaFZhbHVlKGNvbG9yVmFsdWUpO1xuICAgIH1cblxuICAgIGlmIChmb3JtYXQgJiYgdGhpcy5mb3JtYXQpIHtcbiAgICAgIHRoaXMudmFsaWRhdGVGb3JtLmdldCgnaXNGb3JtYXQnKT8ucGF0Y2hWYWx1ZSh0aGlzLmZvcm1hdCk7XG4gICAgfVxuXG4gICAgaWYgKGNsZWFyQ29sb3IgJiYgdGhpcy5jbGVhckNvbG9yKSB7XG4gICAgICB0aGlzLnZhbGlkYXRlRm9ybS5nZXQoJ3JvdW5kQScpPy5wYXRjaFZhbHVlKDApO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xuICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcbiAgfVxufVxuIl19